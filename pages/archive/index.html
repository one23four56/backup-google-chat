<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      display: inline-flex;
      width: 100%;
      height: 100%;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      overflow: hidden;
    }

    input#submit {
      width: 100%;
    }

    h1, label, p {
      font-family: Verdana, Geneva, Tahoma, sans-serif;
    }

    body > p {
      font-family: monospace;
      text-align: center;
    }
  </style>
  <title>$RoomName$ Archive - Backup Google Chat</title>
</head>
<body>

  <h1>$RoomName$ Archive Loader</h1>

  <form action="archive/view">
    <fieldset>
      <label for="start">
        Start at message
        #<input type="number" name="start" id="start" placeholder="enter a number" min="0" required>
      </label>
      <br>
      <label for="count">
        Show the next
        <input type="number" name="count" id="count" placeholder="enter a number" min="1" required>
        messages
      </label>
      <br>
      <label for="focus">
        Highlight message
        #<input type="number" name="focus" id="focus" placeholder="enter a number" min="0">
        (optional)
      </label>
    </fieldset>
    <br>
    <fieldset>
      <label for="reverse">
        <input type="checkbox" name="reverse" id="reverse">
        Reverse Mode
        (message #0 is the latest message sent instead of the first message sent)
      </label>
      <br>
      <label for="noImages">
        <input type="checkbox" name="noImages" id="noImages" checked>
        Hide Images
        (DRASTICALLY improves load times)
      </label>
    </fieldset>
    <br>
    <fieldset>
      <p id="noPresetDisplay">
        <a href="/search">Search</a> for a message
      </p>
      <p id="presetDisplay" style="display: none;">
        Search preset selected (message #
      </p>
    </fieldset>
    <br>
    <input type="submit" value="Load" id="submit">
  </form>

  <p>Archive Stats Loading...</p>

  <script>
      const id = id => document.getElementById(id);
      const message = new URLSearchParams(window.location.search).get('message');
      
      if (message) {
        id('noPresetDisplay').style.display = 'none';
        id('presetDisplay').style.display = 'initial';
        id('presetDisplay').innerText += message + ')';

        id('start').value = Number(message) - 50 >= 0 ? Number(message) - 50 : 0;
        id('count').value = 100;
        id('focus').value = Number(message);

        id('submit').focus()
      }

      fetch('archive/stats').then(res=>res.json().then(data => {
        document.querySelector("body > p").innerText = 
        `${data.totalMessages} Total Messages / ${(data.size / 1000000).toFixed(2)} MB\nYou have sent ${data.myMessages} messages, which is ${((data.myMessages / data.totalMessages) * 100).toFixed(2)}% of the total messages.`;
      }))
  </script>
</body>

</html>